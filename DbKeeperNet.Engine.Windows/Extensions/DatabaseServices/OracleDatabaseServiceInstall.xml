<?xml version="1.0" encoding="utf-8" ?>
<upd:Updates xmlns:upd="http://code.google.com/p/dbkeepernet/Updates-1.0.xsd"
                	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	              xsi:schemaLocation="http://code.google.com/p/dbkeepernet/Updates-1.0.xsd Updates-1.0.xsd"
                AssemblyName="DbKeeperNet.Engine">
  <DefaultPreconditions>
    <Precondition FriendlyName="Update step executed" Precondition="StepNotExecuted"/>
  </DefaultPreconditions>
  <Update Version="1.00">
    <UpdateStep xsi:type="upd:UpdateDbStepType" FriendlyName="Create table dbkeepernet_assembly" Id="1"
                MarkAsExecuted="false">
      <Preconditions>
        <Precondition FriendlyName="Table dbkeepernet_assembly not found" Precondition="DbTableNotFound">
          <Param>DBKEEPERNET_ASSEMBLY</Param>
        </Precondition>
      </Preconditions>
      <AlternativeStatement DbType="Oracle">
        <![CDATA[
		CREATE table "DBKEEPERNET_ASSEMBLY" (
			"ID"         NUMBER(10,0) NOT NULL,
			"ASSEMBLY"   VARCHAR(255) NOT NULL,
			"CREATED"    DATE NOT NULL,
			CONSTRAINT "UQ_dbkeepernet_assembly" UNIQUE ("ASSEMBLY"),
			constraint  "PK_dbkeepernet_assembly" primary key ("ID")
		)
		]]>
      </AlternativeStatement>
    </UpdateStep>
    <UpdateStep xsi:type="upd:UpdateDbStepType" FriendlyName="Create sequence DBKEEPERNET_ASSEMBLY_SEQ" Id="2"
            MarkAsExecuted="false">
      <Preconditions>
        <Precondition FriendlyName="Sequence DBKEEPERNET_ASSEMBLY_SEQ not found" Precondition="OraDbSequenceNotFound">
          <Param>DBKEEPERNET_ASSEMBLY_SEQ</Param>
        </Precondition>
      </Preconditions>
      <AlternativeStatement DbType="Oracle">
        <![CDATA[CREATE sequence "DBKEEPERNET_ASSEMBLY_SEQ"]]>
      </AlternativeStatement>
    </UpdateStep>
    <UpdateStep xsi:type="upd:UpdateDbStepType" FriendlyName="Create trigger BI_DBKEEPERNET_ASSEMBLY" Id="3"
            MarkAsExecuted="false">
      <Preconditions>
        <Precondition FriendlyName="Trigger BI_DBKEEPERNET_ASSEMBLY not found" Precondition="DbTriggerNotFound">
          <Param>BI_DBKEEPERNET_ASSEMBLY</Param>
        </Precondition>
      </Preconditions>
      <AlternativeStatement DbType="Oracle">
        <![CDATA[
		CREATE trigger "BI_DBKEEPERNET_ASSEMBLY"  
		  before insert on "DBKEEPERNET_ASSEMBLY"              
		  for each row 
			begin  
				select "DBKEEPERNET_ASSEMBLY_SEQ".nextval into :NEW.ID from dual;
			end;
		]]>
      </AlternativeStatement>
    </UpdateStep>
    <UpdateStep xsi:type="upd:UpdateDbStepType" FriendlyName="Create table dbkeepernet_version" Id="4"
                MarkAsExecuted="false">
      <Preconditions>
        <Precondition FriendlyName="Table dbkeepernet_version not found" Precondition="DbTableNotFound">
          <Param>DBKEEPERNET_VERSION</Param>
        </Precondition>
      </Preconditions>
      <AlternativeStatement DbType="Oracle">
      <![CDATA[
        CREATE TABLE "DBKEEPERNET_VERSION"
        (
			"ID"         NUMBER(10,0) NOT NULL,
			"DBKEEPERNET_ASSEMBLY_ID" NUMBER(10,0) NOT NULL,
			"VERSION" varchar(32) not null,
			"CREATED" date not null,
			CONSTRAINT "UQ_dbkeepernet_version" UNIQUE ("DBKEEPERNET_ASSEMBLY_ID", "VERSION"),
			CONSTRAINT "PK_dbkeepernet_version" PRIMARY KEY ("ID"),
			CONSTRAINT "FK_dbknetver_dbknetasm_id" FOREIGN KEY ("DBKEEPERNET_ASSEMBLY_ID") REFERENCES "DBKEEPERNET_ASSEMBLY"  ("ID")
        )
  		]]>
      </AlternativeStatement>
    </UpdateStep>
    <UpdateStep xsi:type="upd:UpdateDbStepType" FriendlyName="Create sequence DBKEEPERNET_VERSION_SEQ" Id="5"
            MarkAsExecuted="false">
      <Preconditions>
        <Precondition FriendlyName="Sequence DBKEEPERNET_VERSION_SEQ not found" Precondition="OraDbSequenceNotFound">
          <Param>DBKEEPERNET_VERSION_SEQ</Param>
        </Precondition>
      </Preconditions>
      <AlternativeStatement DbType="Oracle">
        <![CDATA[CREATE sequence "DBKEEPERNET_VERSION_SEQ" ]]>
      </AlternativeStatement>
    </UpdateStep>
	    <UpdateStep xsi:type="upd:UpdateDbStepType" FriendlyName="Create trigger BI_DBKEEPERNET_VERSION" Id="6"
            MarkAsExecuted="false">
      <Preconditions>
        <Precondition FriendlyName="Trigger BI_DBKEEPERNET_VERSION not found" Precondition="DbTriggerNotFound">
          <Param>BI_DBKEEPERNET_VERSION</Param>
        </Precondition>
      </Preconditions>
      <AlternativeStatement DbType="Oracle">
        <![CDATA[	
		CREATE trigger "BI_DBKEEPERNET_VERSION"  
		  before insert on "DBKEEPERNET_VERSION"              
		  for each row 
			begin  
				select "DBKEEPERNET_VERSION_SEQ".nextval into :NEW.ID from dual;
			end;
			
        ]]>
      </AlternativeStatement>
    </UpdateStep>
    <UpdateStep xsi:type="upd:UpdateDbStepType" FriendlyName="Create table dbkeepernet_step" Id="7"
                MarkAsExecuted="false">
      <Preconditions>
        <Precondition FriendlyName="Table dbkeepernet_step not found" Precondition="DbTableNotFound">
          <Param>DBKEEPERNET_STEP</Param>
        </Precondition>
      </Preconditions>
      <AlternativeStatement DbType="Oracle">
        <![CDATA[
        CREATE TABLE "DBKEEPERNET_STEP"
        (
        "ID"         NUMBER(10,0) NOT NULL,
        "DBKEEPERNET_VERSION_ID" NUMBER(10,0) NOT NULL,
        "STEP" NUMBER(10,0) NOT NULL,
        "CREATED" date not null,
        CONSTRAINT "UQ_dbkeepernet_step" UNIQUE ("DBKEEPERNET_VERSION_ID", "STEP"),
        CONSTRAINT "PK_dbkeepernet_step" PRIMARY KEY ("ID"),
        CONSTRAINT "FK_dbknetstep_dbknetver_id" FOREIGN KEY ("DBKEEPERNET_VERSION_ID") REFERENCES "DBKEEPERNET_VERSION" ("ID")
        )
        ]]>
      </AlternativeStatement>
    </UpdateStep>
    <UpdateStep xsi:type="upd:UpdateDbStepType" FriendlyName="Create sequence DBKEEPERNET_STEP_SEQ" Id="8"
            MarkAsExecuted="false">
      <Preconditions>
        <Precondition FriendlyName="Sequence DBKEEPERNET_STEP_SEQ not found" Precondition="OraDbSequenceNotFound">
          <Param>DBKEEPERNET_STEP_SEQ</Param>
        </Precondition>
      </Preconditions>
      <AlternativeStatement DbType="Oracle">
        <![CDATA[CREATE sequence "DBKEEPERNET_STEP_SEQ" ]]>
    </AlternativeStatement>
  </UpdateStep>
  <UpdateStep xsi:type="upd:UpdateDbStepType" FriendlyName="Create trigger BI_DBKEEPERNET_STEP" Id="9"
        MarkAsExecuted="false">
    <Preconditions>
      <Precondition FriendlyName="Trigger BI_DBKEEPERNET_STEP not found" Precondition="DbTriggerNotFound">
        <Param>BI_DBKEEPERNET_STEP</Param>
      </Precondition>
    </Preconditions>
    <AlternativeStatement DbType="Oracle">
      <![CDATA[	
		CREATE trigger "BI_DBKEEPERNET_STEP"  
		  before insert on "DBKEEPERNET_STEP"              
		  for each row 
			begin  
				select "DBKEEPERNET_STEP_SEQ".nextval into :NEW.ID from dual;
			end;
			]]>
      </AlternativeStatement>
    </UpdateStep>
  </Update>
</upd:Updates>

